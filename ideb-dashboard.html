<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard IDEB - Evolu√ß√£o do Brasil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Evolu√ß√£o do IDEB no Brasil</h1>
            <p class="text-gray-600 text-lg">An√°lise da Educa√ß√£o B√°sica (2005-2023)</p>
        </div>

        <!-- Upload Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-800">üìä Gerenciar Dados</h3>
                <div class="flex gap-3">
                    <button onclick="downloadTemplate()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                        ‚¨áÔ∏è Baixar Modelo Excel
                    </button>
                    <label class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition cursor-pointer">
                        ‚¨ÜÔ∏è Carregar Arquivo Excel
                        <input type="file" accept=".xlsx,.xls" onchange="handleFileUpload(event)" class="hidden">
                    </label>
                </div>
            </div>
            
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                <p class="text-sm text-blue-900"><strong>Como usar:</strong></p>
                <ol class="text-sm text-blue-800 mt-2 ml-4 list-decimal space-y-1">
                    <li>Clique em "Baixar Modelo Excel" para obter o template</li>
                    <li>Abra no Excel e preencha com seus dados</li>
                    <li>Salve o arquivo Excel (.xlsx)</li>
                    <li>Clique em "Carregar Arquivo Excel" e selecione seu arquivo</li>
                    <li>O dashboard ser√° atualizado automaticamente!</li>
                </ol>
                <p class="text-sm text-blue-900 mt-3">
                    <strong>üí° Formato:</strong> O Excel deve ter as colunas: Ano, Anos_Iniciais, Meta_Iniciais, Anos_Finais, Meta_Finais, Ensino_Medio, Meta_Medio
                </p>
            </div>
            
            <div id="uploadStatus" class="mt-4 hidden"></div>
        </div>

        <!-- Cards de Destaque -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-green-500">
                <p class="text-gray-500 text-sm font-medium">Anos Iniciais</p>
                <p class="text-3xl font-bold mt-2" id="card-iniciais">6.0</p>
                <p class="text-gray-600 text-sm mt-1" id="card-iniciais-sub">+57.9% desde 2005</p>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-blue-500">
                <p class="text-gray-500 text-sm font-medium">Anos Finais</p>
                <p class="text-3xl font-bold mt-2" id="card-finais">5.0</p>
                <p class="text-gray-600 text-sm mt-1" id="card-finais-sub">+42.9% desde 2005</p>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-purple-500">
                <p class="text-gray-500 text-sm font-medium">Ensino M√©dio</p>
                <p class="text-3xl font-bold mt-2" id="card-medio">4.3</p>
                <p class="text-gray-600 text-sm mt-1" id="card-medio-sub">+26.5% desde 2005</p>
            </div>
        </div>

        <!-- Filtros -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex items-center gap-4 mb-6">
                <span class="font-semibold text-gray-700">Visualizar:</span>
                <button onclick="filterStage('all')" id="btn-all" class="px-4 py-2 rounded-lg bg-indigo-600 text-white">Todas as Etapas</button>
                <button onclick="filterStage('iniciais')" id="btn-iniciais" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700">Anos Iniciais</button>
                <button onclick="filterStage('finais')" id="btn-finais" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700">Anos Finais</button>
                <button onclick="filterStage('medio')" id="btn-medio" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700">Ensino M√©dio</button>
            </div>

            <!-- Gr√°fico de Evolu√ß√£o -->
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Evolu√ß√£o Temporal do IDEB</h3>
            <canvas id="chartEvolution" height="100"></canvas>
        </div>

        <!-- Gr√°fico de Crescimento -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Crescimento Total por Etapa (2005-2023)</h3>
            <canvas id="chartGrowth" height="80"></canvas>
        </div>

        <!-- Tabela -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Dados Completos - IDEB por Ano</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm" id="dataTable">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-3 text-left font-semibold">Ano</th>
                            <th class="px-4 py-3 text-center font-semibold">Anos Iniciais</th>
                            <th class="px-4 py-3 text-center font-semibold">Meta</th>
                            <th class="px-4 py-3 text-center font-semibold">Anos Finais</th>
                            <th class="px-4 py-3 text-center font-semibold">Meta</th>
                            <th class="px-4 py-3 text-center font-semibold">Ensino M√©dio</th>
                            <th class="px-4 py-3 text-center font-semibold">Meta</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <div class="mt-4 flex items-center gap-4 text-sm">
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-green-600 rounded"></div>
                    <span>Meta atingida</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-red-600 rounded"></div>
                    <span>Meta n√£o atingida</span>
                </div>
            </div>
        </div>

        <!-- Insights -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">üí° Principais Insights</h3>
            <div class="space-y-4 text-gray-700">
                <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                    <p class="font-semibold text-green-800 mb-1">‚úì Anos Iniciais - Melhor Desempenho</p>
                    <p>Crescimento de <strong>57.9%</strong> (3.8 ‚Üí 6.0). √önica etapa que consistentemente superou as metas at√© 2019.</p>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                    <p class="font-semibold text-blue-800 mb-1">‚Üí Anos Finais - Crescimento Moderado</p>
                    <p>Crescimento de <strong>42.9%</strong> (3.5 ‚Üí 5.0). Desafio na transi√ß√£o do Fundamental I para o Fundamental II.</p>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                    <p class="font-semibold text-purple-800 mb-1">‚ö† Ensino M√©dio - Maior Desafio</p>
                    <p>Crescimento de apenas <strong>26.5%</strong> (3.4 ‚Üí 4.3). Nunca atingiu as metas estabelecidas.</p>
                </div>
                <div class="p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-500">
                    <p class="font-semibold text-yellow-800 mb-1">üìâ Impacto da Pandemia (2021)</p>
                    <p>Todas as etapas tiveram queda ou estagna√ß√£o em 2021. Recupera√ß√£o vis√≠vel em 2023.</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-gray-600 text-sm">
            <p>Fonte: INEP - Instituto Nacional de Estudos e Pesquisas Educacionais An√≠sio Teixeira</p>
            <p class="mt-1">Dashboard desenvolvido para an√°lise da evolu√ß√£o do IDEB no Brasil</p>
        </div>
    </div>

    <script>
        // Dados padr√£o
        let currentData = [
            { ano: 2005, anosIniciais: 3.8, metaIniciais: null, anosFinais: 3.5, metaFinais: null, ensinoMedio: 3.4, metaMedio: null },
            { ano: 2007, anosIniciais: 4.2, metaIniciais: 3.9, anosFinais: 3.8, metaFinais: 3.5, ensinoMedio: 3.5, metaMedio: 3.4 },
            { ano: 2009, anosIniciais: 4.6, metaIniciais: 4.2, anosFinais: 4.0, metaFinais: 3.7, ensinoMedio: 3.6, metaMedio: 3.5 },
            { ano: 2011, anosIniciais: 5.0, metaIniciais: 4.6, anosFinais: 4.1, metaFinais: 3.9, ensinoMedio: 3.7, metaMedio: 3.7 },
            { ano: 2013, anosIniciais: 5.2, metaIniciais: 4.9, anosFinais: 4.2, metaFinais: 4.4, ensinoMedio: 3.7, metaMedio: 3.9 },
            { ano: 2015, anosIniciais: 5.5, metaIniciais: 5.2, anosFinais: 4.5, metaFinais: 4.7, ensinoMedio: 3.7, metaMedio: 4.3 },
            { ano: 2017, anosIniciais: 5.8, metaIniciais: 5.5, anosFinais: 4.7, metaFinais: 5.0, ensinoMedio: 3.8, metaMedio: 4.7 },
            { ano: 2019, anosIniciais: 5.9, metaIniciais: 5.7, anosFinais: 4.9, metaFinais: 5.2, ensinoMedio: 4.2, metaMedio: 5.0 },
            { ano: 2021, anosIniciais: 5.8, metaIniciais: 6.0, anosFinais: 5.1, metaFinais: 5.5, ensinoMedio: 4.2, metaMedio: 5.2 },
            { ano: 2023, anosIniciais: 6.0, metaIniciais: null, anosFinais: 5.0, metaFinais: null, ensinoMedio: 4.3, metaMedio: null }
        ];

        let chartEvolution, chartGrowth;
        let currentFilter = 'all';

        // Inicializar
        window.onload = function() {
            updateCards();
            createCharts();
            updateTable();
        };

        function downloadTemplate() {
            // Criar workbook
            const wb = XLSX.utils.book_new();
            
            // Dados do template
            const data = [
                ['Ano', 'Anos_Iniciais', 'Meta_Iniciais', 'Anos_Finais', 'Meta_Finais', 'Ensino_Medio', 'Meta_Medio'],
                [2005, 3.8, '', 3.5, '', 3.4, ''],
                [2007, 4.2, 3.9, 3.8, 3.5, 3.5, 3.4],
                [2009, 4.6, 4.2, 4.0, 3.7, 3.6, 3.5],
                [2011, 5.0, 4.6, 4.1, 3.9, 3.7, 3.7],
                [2013, 5.2, 4.9, 4.2, 4.4, 3.7, 3.9],
                [2015, 5.5, 5.2, 4.5, 4.7, 3.7, 4.3],
                [2017, 5.8, 5.5, 4.7, 5.0, 3.8, 4.7],
                [2019, 5.9, 5.7, 4.9, 5.2, 4.2, 5.0],
                [2021, 5.8, 6.0, 5.1, 5.5, 4.2, 5.2],
                [2023, 6.0, '', 5.0, '', 4.3, '']
            ];
            
            // Criar worksheet
            const ws = XLSX.utils.aoa_to_sheet(data);
            
            // Adicionar ao workbook
            XLSX.utils.book_append_sheet(wb, ws, 'IDEB');
            
            // Salvar arquivo
            XLSX.writeFile(wb, 'modelo_ideb.xlsx');
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Pegar a primeira planilha
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    // Processar dados
                    const newData = jsonData.map(row => ({
                        ano: parseInt(row.Ano),
                        anosIniciais: parseFloat(row.Anos_Iniciais) || null,
                        metaIniciais: parseFloat(row.Meta_Iniciais) || null,
                        anosFinais: parseFloat(row.Anos_Finais) || null,
                        metaFinais: parseFloat(row.Meta_Finais) || null,
                        ensinoMedio: parseFloat(row.Ensino_Medio) || null,
                        metaMedio: parseFloat(row.Meta_Medio) || null
                    })).filter(row => row.ano);
                    
                    currentData = newData;
                    updateCards();
                    createCharts();
                    updateTable();
                    
                    document.getElementById('uploadStatus').innerHTML = `
                        <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                            <p class="text-green-800 font-semibold">‚úì Arquivo Excel carregado com sucesso! (${newData.length} registros)</p>
                        </div>
                    `;
                    document.getElementById('uploadStatus').classList.remove('hidden');
                } catch (error) {
                    alert('Erro ao processar arquivo Excel. Verifique se o formato est√° correto!');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function calcGrowth(initial, final) {
            if (!initial || !final) return 0;
            return (((final - initial) / initial) * 100).toFixed(1);
        }

        function updateCards() {
            const first = currentData[0];
            const last = currentData[currentData.length - 1];
            
            document.getElementById('card-iniciais').textContent = last.anosIniciais.toFixed(1);
            document.getElementById('card-finais').textContent = last.anosFinais.toFixed(1);
            document.getElementById('card-medio').textContent = last.ensinoMedio.toFixed(1);
            
            document.getElementById('card-iniciais-sub').textContent = `+${calcGrowth(first.anosIniciais, last.anosIniciais)}% desde ${first.ano}`;
            document.getElementById('card-finais-sub').textContent = `+${calcGrowth(first.anosFinais, last.anosFinais)}% desde ${first.ano}`;
            document.getElementById('card-medio-sub').textContent = `+${calcGrowth(first.ensinoMedio, last.ensinoMedio)}% desde ${first.ano}`;
        }

        function createCharts() {
            const anos = currentData.map(d => d.ano);
            
            // Gr√°fico de Evolu√ß√£o
            if (chartEvolution) chartEvolution.destroy();
            
            const ctx1 = document.getElementById('chartEvolution').getContext('2d');
            chartEvolution = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: anos,
                    datasets: getDatasets()
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: false, min: 3, max: 7 }
                    }
                }
            });

            // Gr√°fico de Crescimento
            if (chartGrowth) chartGrowth.destroy();
            
            const first = currentData[0];
            const last = currentData[currentData.length - 1];
            
            const ctx2 = document.getElementById('chartGrowth').getContext('2d');
            chartGrowth = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Anos Iniciais', 'Anos Finais', 'Ensino M√©dio'],
                    datasets: [{
                        label: 'Crescimento (%)',
                        data: [
                            calcGrowth(first.anosIniciais, last.anosIniciais),
                            calcGrowth(first.anosFinais, last.anosFinais),
                            calcGrowth(first.ensinoMedio, last.ensinoMedio)
                        ],
                        backgroundColor: ['#10b981', '#3b82f6', '#8b5cf6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function getDatasets() {
            const datasets = [];
            
            if (currentFilter === 'all' || currentFilter === 'iniciais') {
                datasets.push({
                    label: 'Anos Iniciais',
                    data: currentData.map(d => d.anosIniciais),
                    borderColor: '#10b981',
                    backgroundColor: '#10b981',
                    borderWidth: 3
                });
                datasets.push({
                    label: 'Meta - Anos Iniciais',
                    data: currentData.map(d => d.metaIniciais),
                    borderColor: '#10b981',
                    backgroundColor: '#10b981',
                    borderWidth: 2,
                    borderDash: [5, 5]
                });
            }
            
            if (currentFilter === 'all' || currentFilter === 'finais') {
                datasets.push({
                    label: 'Anos Finais',
                    data: currentData.map(d => d.anosFinais),
                    borderColor: '#3b82f6',
                    backgroundColor: '#3b82f6',
                    borderWidth: 3
                });
                datasets.push({
                    label: 'Meta - Anos Finais',
                    data: currentData.map(d => d.metaFinais),
                    borderColor: '#3b82f6',
                    backgroundColor: '#3b82f6',
                    borderWidth: 2,
                    borderDash: [5, 5]
                });
            }
            
            if (currentFilter === 'all' || currentFilter === 'medio') {
                datasets.push({
                    label: 'Ensino M√©dio',
                    data: currentData.map(d => d.ensinoMedio),
                    borderColor: '#8b5cf6',
                    backgroundColor: '#8b5cf6',
                    borderWidth: 3
                });
                datasets.push({
                    label: 'Meta - Ensino M√©dio',
                    data: currentData.map(d => d.metaMedio),
                    borderColor: '#8b5cf6',
                    backgroundColor: '#8b5cf6',
                    borderWidth: 2,
                    borderDash: [5, 5]
                });
            }
            
            return datasets;
        }

        function filterStage(stage) {
            currentFilter = stage;
            
            // Update buttons
            ['all', 'iniciais', 'finais', 'medio'].forEach(s => {
                const btn = document.getElementById(`btn-${s}`);
                if (s === stage) {
                    btn.className = 'px-4 py-2 rounded-lg bg-indigo-600 text-white';
                } else {
                    btn.className = 'px-4 py-2 rounded-lg bg-gray-200 text-gray-700';
                }
            });
            
            chartEvolution.data.datasets = getDatasets();
            chartEvolution.update();
        }

        function updateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            currentData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'border-b hover:bg-gray-50';
                
                const getColor = (value, meta) => {
                    if (!meta) return 'text-gray-700';
                    return value >= meta ? 'text-green-600' : 'text-red-600';
                };
                
                tr.innerHTML = `
                    <td class="px-4 py-3 font-semibold">${row.ano}</td>
                    <td class="px-4 py-3 text-center font-semibold ${getColor(row.anosIniciais, row.metaIniciais)}">${row.anosIniciais ? row.anosIniciais.toFixed(1) : '-'}</td>
                    <td class="px-4 py-3 text-center text-gray-500">${row.metaIniciais ? row.metaIniciais.toFixed(1) : '-'}</td>
                    <td class="px-4 py-3 text-center font-semibold ${getColor(row.anosFinais, row.metaFinais)}">${row.anosFinais ? row.anosFinais.toFixed(1) : '-'}</td>
                    <td class="px-4 py-3 text-center text-gray-500">${row.metaFinais ? row.metaFinais.toFixed(1) : '-'}</td>
                    <td class="px-4 py-3 text-center font-semibold ${getColor(row.ensinoMedio, row.metaMedio)}">${row.ensinoMedio ? row.ensinoMedio.toFixed(1) : '-'}</td>
                    <td class="px-4 py-3 text-center text-gray-500">${row.metaMedio ? row.metaMedio.toFixed(1) : '-'}</td>
                `;
                
                tbody.appendChild(tr);
            });
        }
    </script>
</body>
</html>