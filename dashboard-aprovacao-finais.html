<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Taxa de Aprova√ß√£o - Anos Finais</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 to-cyan-100 min-h-screen p-8">
    <div class="max-w-7xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Taxa de Aprova√ß√£o - Anos Finais</h1>
            <p class="text-gray-600 text-lg">An√°lise por Rede de Ensino (6¬∫ ao 9¬∫ ano) - Brasil</p>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-800">üìä Gerenciar Dados</h3>
                <div class="flex gap-3">
                    <button onclick="downloadTemplate()"
                        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                        ‚¨áÔ∏è Baixar Modelo Excel
                    </button>
                    <label
                        class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition cursor-pointer">
                        ‚¨ÜÔ∏è Carregar Arquivo Excel
                        <input type="file" accept=".xlsx,.xls" onchange="handleFileUpload(event)" class="hidden">
                    </label>
                </div>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                <p class="text-sm text-blue-900"><strong>Como usar:</strong></p>
                <ol class="text-sm text-blue-800 mt-2 ml-4 list-decimal space-y-1">
                    <li>Clique em "Baixar Modelo Excel"</li>
                    <li>Preencha com os dados do 6¬∫, 7¬∫, 8¬∫ e 9¬∫ ano</li>
                    <li>Salve o arquivo (.xlsx)</li>
                    <li>Fa√ßa upload</li>
                </ol>
                <p class="text-sm text-blue-900 mt-3">
                    <strong>üí° Formato:</strong> Ano, Rede, Serie_6, Serie_7, Serie_8, Serie_9, Indicador_Rendimento,
                    Meta
                </p>
            </div>

            <div id="uploadStatus" class="mt-4 hidden"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">

            <div class="bg-white rounded-lg shadow-lg p-4 border-l-4 border-blue-500">
                <p class="text-gray-500 text-xs font-medium uppercase">Total Brasil (2023)</p>
                <p class="text-2xl font-bold mt-2 text-gray-800" id="card-total">94.0%</p>
                <p class="text-gray-600 text-xs mt-1">Indicador: 0.94</p>
                <p class="text-blue-600 text-xs mt-1 font-semibold">‚úÖ Meta Nacional Atingida</p>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-4 border-l-4 border-purple-500">
                <p class="text-gray-500 text-xs font-medium uppercase">Rede Estadual (2023)</p>
                <p class="text-2xl font-bold mt-2 text-gray-800" id="card-estadual">95.1%</p>
                <p class="text-gray-600 text-xs mt-1">Indicador: 0.95</p>
                <p class="text-purple-600 text-xs mt-1 font-semibold">‚ñ≤ Superou a Meta (2023)</p>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-4 border-l-4 border-green-500">
                <p class="text-gray-500 text-xs font-medium uppercase">Rede Municipal (2023)</p>
                <p class="text-2xl font-bold mt-2 text-gray-800" id="card-municipal">90.0%</p>
                <p class="text-gray-600 text-xs mt-1">Indicador: 0.91</p>
                <p class="text-red-600 text-xs mt-1 font-semibold">‚ö†Ô∏è Perto da Meta (91.8%)</p>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-4 border-l-4 border-yellow-500">
                <p class="text-gray-500 text-xs font-medium uppercase">Rede P√∫blica (2023)</p>
                <p class="text-2xl font-bold mt-2 text-gray-800" id="card-publica">92.4%</p>
                <p class="text-gray-600 text-xs mt-1">Indicador: 0.92</p>
                <p class="text-yellow-600 text-xs mt-1 font-semibold">‚ñ≤ Evolu√ß√£o Consistente</p>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-4 border-l-4 border-pink-500">
                <p class="text-gray-500 text-xs font-medium uppercase">Rede Privada (2023)</p>
                <p class="text-2xl font-bold mt-2 text-gray-800" id="card-privada">98.6%</p>
                <p class="text-gray-600 text-xs mt-1">Indicador: 0.98</p>
                <p class="text-pink-600 text-xs mt-1 font-semibold">üèÜ Excel√™ncia e Estabilidade</p>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex items-center gap-4 mb-6 flex-wrap">
                <span class="font-semibold text-gray-700">Visualizar Rede:</span>
                <button onclick="filterRede('all')" id="btn-all"
                    class="px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm">Todas</button>
                <button onclick="filterRede('total')" id="btn-total"
                    class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm">Total</button>
                <button onclick="filterRede('estadual')" id="btn-estadual"
                    class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm">Estadual</button>
                <button onclick="filterRede('municipal')" id="btn-municipal"
                    class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm">Municipal</button>
                <button onclick="filterRede('publica')" id="btn-publica"
                    class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm">P√∫blica</button>
                <button onclick="filterRede('privada')" id="btn-privada"
                    class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm">Privada</button>
            </div>

            <div class="flex items-center gap-4 mb-6 flex-wrap">
                <span class="font-semibold text-gray-700">Visualizar S√©rie:</span>
                <button onclick="filterSerie('media')" id="btn-media"
                    class="px-4 py-2 rounded-lg bg-green-600 text-white text-sm">M√©dia Geral</button>
                <button onclick="filterSerie('6')" id="btn-6"
                    class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm">6¬∫ ano</button>
                <button onclick="filterSerie('7')" id="btn-7"
                    class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm">7¬∫ ano</button>
                <button onclick="filterSerie('8')" id="btn-8"
                    class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm">8¬∫ ano</button>
                <button onclick="filterSerie('9')" id="btn-9"
                    class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm">9¬∫ ano</button>
            </div>

            <h3 class="text-xl font-semibold text-gray-800 mb-4">Evolu√ß√£o da Taxa de Aprova√ß√£o</h3>
            <canvas id="chartEvolution" height="100"></canvas>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Dados Completos por Ano</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-xs" id="dataTable">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-3 py-2 text-left font-semibold">Ano</th>
                            <th class="px-3 py-2 text-left font-semibold">Rede</th>
                            <th class="px-3 py-2 text-center font-semibold">6¬∫ ano</th>
                            <th class="px-3 py-2 text-center font-semibold">7¬∫ ano</th>
                            <th class="px-3 py-2 text-center font-semibold">8¬∫ ano</th>
                            <th class="px-3 py-2 text-center font-semibold">9¬∫ ano</th>
                            <th class="px-3 py-2 text-center font-semibold">M√©dia</th>
                            <th class="px-3 py-2 text-center font-semibold">Meta</th>
                            <th class="px-3 py-2 text-center font-semibold">Indicador (P)</th>
                            <th class="px-3 py-2 text-center font-semibold">Status</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">üí° Insights Detalhados (Ensino Fundamental II - 2023)
            </h3>
            <div class="space-y-4 text-gray-700">

                <div class="p-4 bg-orange-50 rounded-lg border-l-4 border-orange-500">
                    <p class="font-semibold text-orange-800 mb-1">‚ö†Ô∏è Transi√ß√£o Cr√≠tica: 6¬∫ Ano</p>
                    <p>A taxa de aprova√ß√£o no **6¬∫ ano (83.4% no Total)** √© o principal ponto de aten√ß√£o. Este gargalo √©
                        mais acentuado na Rede Municipal, que registra apenas **90.2%** nesta s√©rie, indicando a maior
                        dificuldade na transi√ß√£o para os Anos Finais.</p>
                </div>

                <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                    <p class="font-semibold text-red-800 mb-1">üö® Rede Municipal: Meta N√£o Atingida</p>
                    <p>O indicador de desempenho da Rede Municipal parou em **0.91**, falhando em cumprir a meta
                        estipulada de 91.8%. A Rede Estadual, em contraste, atingiu **95.1%** e superou sua meta,
                        acentuando a disparidade no sistema p√∫blico.</p>
                </div>

                <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                    <p class="font-semibold text-blue-800 mb-1">üéØ Consist√™ncia: Meta Nacional Cumprida</p>
                    <p>O indicador geral (Total Brasil) atingiu **0.94** em 2023, cumprindo exatamente o objetivo de
                        94.0%. A Rede Privada mant√©m o teto de excel√™ncia com indicador **0.98**, atuando como
                        refer√™ncia para o sistema.</p>
                </div>

                <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                    <p class="font-semibold text-green-800 mb-1">üöÄ Destaque na Evolu√ß√£o: Rede Municipal</p>
                    <p>Em uma perspectiva de longo prazo (2005-2023), a Rede Municipal registra o maior crescimento
                        hist√≥rico, com a aprova√ß√£o do 9¬∫ ano saltando de **70.8% para 94.8%**, demonstrando uma forte
                        tend√™ncia de recupera√ß√£o.</p>
                </div>

            </div>
        </div>

        <div class="text-center mt-8 text-gray-600 text-sm">
            <p>Fonte: INEP</p>
            <p class="mt-1">Dashboard - Taxa de Aprova√ß√£o nos Anos Finais do Ensino Fundamental</p>
        </div>
    </div>

    <script>
        let currentData = [
            { ano: 2005, rede: "Total", s6: 72.9, s7: 77.1, s8: 79.5, s9: 79.7, indicador: 0.77, meta: 77.0 },
            { ano: 2005, rede: "Estadual", s6: 73.8, s7: 76.9, s8: 78.4, s9: 76.5, indicador: 0.76, meta: 76.3 },
            { ano: 2005, rede: "Municipal", s6: 67.3, s7: 73.1, s8: 76.8, s9: 80.3, indicador: 0.74, meta: 73.2 },
            { ano: 2005, rede: "P√∫blica", s6: 70.8, s7: 75.3, s8: 77.7, s9: 77.9, indicador: 0.75, meta: 75.0 },
            { ano: 2005, rede: "Privada", s6: 94.9, s7: 94.4, s8: 94.5, s9: 94.2, indicador: 0.94, meta: 94.5 },

            { ano: 2007, rede: "Total", s6: 76.2, s7: 80.0, s8: 82.4, s9: 81.5, indicador: 0.80, meta: 79.8 },
            { ano: 2007, rede: "Estadual", s6: 76.3, s7: 79.4, s8: 81.0, s9: 78.3, indicador: 0.79, meta: 78.7 },
            { ano: 2007, rede: "Municipal", s6: 72.3, s7: 77.6, s8: 81.2, s9: 83.1, indicador: 0.78, meta: 77.6 },
            { ano: 2007, rede: "P√∫blica", s6: 74.5, s7: 78.7, s8: 81.1, s9: 80.0, indicador: 0.78, meta: 78.2 },
            { ano: 2007, rede: "Privada", s6: 95.6, s7: 94.8, s8: 94.9, s9: 94.9, indicador: 0.95, meta: 95.1 },

            { ano: 2009, rede: "Total", s6: 77.7, s7: 81.4, s8: 83.6, s9: 83.7, indicador: 0.82, meta: 81.3 },
            { ano: 2009, rede: "Estadual", s6: 77.9, s7: 81.1, s8: 82.3, s9: 80.8, indicador: 0.80, meta: 80.5 },
            { ano: 2009, rede: "Municipal", s6: 73.3, s7: 78.1, s8: 81.9, s9: 84.6, indicador: 0.79, meta: 78.6 },
            { ano: 2009, rede: "P√∫blica", s6: 75.7, s7: 79.8, s8: 82.1, s9: 82.2, indicador: 0.80, meta: 79.7 },
            { ano: 2009, rede: "Privada", s6: 95.2, s7: 94.3, s8: 94.5, s9: 94.3, indicador: 0.95, meta: 94.6 },

            { ano: 2011, rede: "Total", s6: 80.1, s7: 83.4, s8: 85.2, s9: 85.5, indicador: 0.83, meta: 83.4 },
            { ano: 2011, rede: "Estadual", s6: 80.2, s7: 83.3, s8: 83.6, s9: 82.2, indicador: 0.82, meta: 82.3 },
            { ano: 2011, rede: "Municipal", s6: 76.0, s7: 80.3, s8: 84.2, s9: 87.2, indicador: 0.82, meta: 81.1 },
            { ano: 2011, rede: "P√∫blica", s6: 78.2, s7: 82.0, s8: 83.9, s9: 84.1, indicador: 0.82, meta: 81.8 },
            { ano: 2011, rede: "Privada", s6: 94.9, s7: 94.2, s8: 94.3, s9: 94.4, indicador: 0.94, meta: 94.5 },

            { ano: 2013, rede: "Total", s6: 82.2, s7: 84.5, s8: 86.8, s9: 87.6, indicador: 0.85, meta: 85.1 },
            { ano: 2013, rede: "Estadual", s6: 83.9, s7: 85.2, s8: 86.3, s9: 85.2, indicador: 0.85, meta: 85.1 },
            { ano: 2013, rede: "Municipal", s6: 77.0, s7: 80.8, s8: 84.7, s9: 88.3, indicador: 0.82, meta: 82.0 },
            { ano: 2013, rede: "P√∫blica", s6: 80.3, s7: 83.1, s8: 85.6, s9: 86.5, indicador: 0.84, meta: 83.7 },
            { ano: 2013, rede: "Privada", s6: 95.1, s7: 94.2, s8: 94.6, s9: 94.6, indicador: 0.95, meta: 94.6 },

            { ano: 2015, rede: "Total", s6: 82.9, s7: 84.6, s8: 87.3, s9: 88.6, indicador: 0.86, meta: 85.7 },
            { ano: 2015, rede: "Estadual", s6: 83.7, s7: 84.7, s8: 86.6, s9: 86.1, indicador: 0.85, meta: 85.3 },
            { ano: 2015, rede: "Municipal", s6: 78.2, s7: 81.0, s8: 85.3, s9: 89.3, indicador: 0.83, meta: 82.8 },
            { ano: 2015, rede: "P√∫blica", s6: 80.8, s7: 82.8, s8: 86.0, s9: 87.5, indicador: 0.84, meta: 84.1 },
            { ano: 2015, rede: "Privada", s6: 95.8, s7: 95.0, s8: 95.3, s9: 95.2, indicador: 0.95, meta: 95.3 },

            { ano: 2017, rede: "Total", s6: 84.5, s7: 86.5, s8: 88.7, s9: 89.6, indicador: 0.87, meta: 87.1 },
            { ano: 2017, rede: "Estadual", s6: 85.5, s7: 86.8, s8: 88.0, s9: 87.0, indicador: 0.87, meta: 86.8 },
            { ano: 2017, rede: "Municipal", s6: 79.9, s7: 82.8, s8: 86.5, s9: 90.0, indicador: 0.85, meta: 84.2 },
            { ano: 2017, rede: "P√∫blica", s6: 82.4, s7: 84.8, s8: 87.3, s9: 88.4, indicador: 0.86, meta: 85.5 },
            { ano: 2017, rede: "Privada", s6: 96.9, s7: 96.3, s8: 96.5, s9: 96.3, indicador: 0.96, meta: 96.5 },

            { ano: 2019, rede: "Total", s6: 87.9, s7: 89.1, s8: 91.0, s9: 92.3, indicador: 0.90, meta: 89.9 },
            { ano: 2019, rede: "Estadual", s6: 89.2, s7: 89.6, s8: 90.8, s9: 90.4, indicador: 0.90, meta: 90.0 },
            { ano: 2019, rede: "Municipal", s6: 83.7, s7: 85.9, s8: 88.9, s9: 92.7, indicador: 0.88, meta: 87.3 },
            { ano: 2019, rede: "P√∫blica", s6: 86.2, s7: 87.7, s8: 89.9, s9: 91.5, indicador: 0.89, meta: 88.6 },
            { ano: 2019, rede: "Privada", s6: 97.4, s7: 97.0, s8: 97.1, s9: 97.1, indicador: 0.97, meta: 97.1 },

            { ano: 2021, rede: "Total", s6: 96.2, s7: 95.1, s8: 95.6, s9: 96.1, indicador: 0.96, meta: 95.7 },
            { ano: 2021, rede: "Estadual", s6: 96.8, s7: 95.4, s8: 95.7, s9: 95.6, indicador: 0.96, meta: 95.8 },
            { ano: 2021, rede: "Municipal", s6: 94.9, s7: 93.7, s8: 94.5, s9: 95.7, indicador: 0.95, meta: 94.7 },
            { ano: 2021, rede: "P√∫blica", s6: 95.7, s7: 94.5, s8: 95.1, s9: 95.6, indicador: 0.95, meta: 95.2 },
            { ano: 2021, rede: "Privada", s6: 98.8, s7: 98.5, s8: 98.5, s9: 98.7, indicador: 0.99, meta: 98.6 },

            { ano: 2023, rede: "Total", s6: 93.4, s7: 93.7, s8: 93.9, s9: 95.0, indicador: 0.94, meta: 94.0 },
            { ano: 2023, rede: "Estadual", s6: 95.1, s7: 95.0, s8: 94.5, s9: 94.1, indicador: 0.95, meta: 94.7 },
            { ano: 2023, rede: "Municipal", s6: 90.2, s7: 90.9, s8: 91.8, s9: 94.8, indicador: 0.92, meta: 91.8 },
            { ano: 2023, rede: "P√∫blica", s6: 92.4, s7: 92.8, s8: 93.1, s9: 94.4, indicador: 0.93, meta: 93.2 },
            { ano: 2023, rede: "Privada", s6: 98.6, s7: 98.4, s8: 98.4, s9: 98.2, indicador: 0.98, meta: 98.4 }
        ];


        let chartEvolution;
        let currentFilterRede = 'all';
        let currentFilterSerie = 'media';

        window.onload = function () {
            updateCards();
            createChart();
            updateTable();
        };

        function downloadTemplate() {
            const wb = XLSX.utils.book_new();
            const data = [
                ['Ano', 'Rede', 'Serie_6', 'Serie_7', 'Serie_8', 'Serie_9', 'Indicador_Rendimento', 'Meta'],
                [2005, 'Total', 73.2, 67.3, 73.1, 76.8, 0.74, 78.0],
                [2005, 'Estadual', 76.3, 73.8, 76.9, 79.4, 0.76, 80.0],
                [2005, 'Municipal', 70.6, 62.9, 71.7, 76.1, 0.75, 76.0],
                [2005, 'P√∫blica', 75.0, 70.8, 75.3, 77.7, 0.75, 77.0],
                [2005, 'Privada', 94.5, 94.9, 94.4, 94.5, 0.94, ''],
                ['', '', '', '', '', '', '', ''],
                [2023, 'Total', 78.6, 73.3, 78.1, 81.9, 0.78, 85.0],
                [2023, 'Estadual', 82.1, 78.5, 83.2, 86.4, 0.83, 88.0],
                [2023, 'Municipal', 73.9, 67.5, 72.9, 79.8, 0.74, 82.0],
                [2023, 'P√∫blica', 76.8, 71.4, 76.2, 82.1, 0.77, 84.0],
                [2023, 'Privada', 95.7, 94.2, 95.1, 96.4, 0.95, '']
            ];
            const ws = XLSX.utils.aoa_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, 'Taxa_Aprovacao_Finais');
            XLSX.writeFile(wb, 'modelo_taxa_aprovacao_finais.xlsx');
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    const newData = jsonData.map(row => ({
                        ano: parseInt(row.Ano),
                        rede: row.Rede,
                        s6: parseFloat(row.Serie_6) || 0,
                        s7: parseFloat(row.Serie_7) || 0,
                        s8: parseFloat(row.Serie_8) || 0,
                        s9: parseFloat(row.Serie_9) || 0,
                        indicador: parseFloat(row.Indicador_Rendimento) || 0,
                        meta: parseFloat(row.Meta) || null
                    })).filter(row => row.ano && row.rede);
                    currentData = newData;
                    updateCards();
                    createChart();
                    updateTable();
                    document.getElementById('uploadStatus').innerHTML = `
                        <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                            <p class="text-green-800 font-semibold">‚úì Arquivo carregado! (${newData.length} registros)</p>
                        </div>
                    `;
                    document.getElementById('uploadStatus').classList.remove('hidden');
                } catch (error) {
                    alert('Erro ao processar arquivo!');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function updateCards() {
            const lastYear = Math.max(...currentData.map(d => d.ano));
            const lastData = currentData.filter(d => d.ano === lastYear);
            lastData.forEach(d => {
                const media = ((d.s6 + d.s7 + d.s8 + d.s9) / 4).toFixed(1);
                const cardId = `card-${d.rede.toLowerCase()}`;
                const card = document.getElementById(cardId);
                if (card) {
                    card.textContent = `${media}%`;
                    card.nextElementSibling.textContent = `Indicador: ${d.indicador.toFixed(2)}`;
                }
            });
        }

        function createChart() {
            if (chartEvolution) chartEvolution.destroy();
            const anos = [...new Set(currentData.map(d => d.ano))].sort();
            const datasets = getDatasets();
            const ctx = document.getElementById('chartEvolution').getContext('2d');
            chartEvolution = new Chart(ctx, {
                type: 'line',
                data: { labels: anos, datasets: datasets },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 60,
                            max: 100,
                            ticks: { callback: value => value + '%' }
                        }
                    }
                }
            });
        }

        function getDatasets() {
            const anos = [...new Set(currentData.map(d => d.ano))].sort();
            const redes = ['Total', 'Estadual', 'Municipal', 'P√∫blica', 'Privada'];
            const colors = {
                'Total': '#3b82f6', 'Estadual': '#8b5cf6',
                'Municipal': '#10b981', 'P√∫blica': '#f59e0b', 'Privada': '#ec4899'
            };
            const datasets = [];
            redes.forEach(rede => {
                const normalize = txt => txt.normalize("NFD").replace(/[\u0300-\u036f]/g, "");

                if (
                    currentFilterRede !== 'all' &&
                    normalize(currentFilterRede) !== normalize(rede.toLowerCase())
                ) return;
                const data = anos.map(ano => {
                    const row = currentData.find(d => d.ano === ano && d.rede === rede);
                    if (!row) return null;
                    if (currentFilterSerie === 'media') {
                        return ((row.s6 + row.s7 + row.s8 + row.s9) / 4).toFixed(1);
                    } else {
                        return row[`s${currentFilterSerie}`];
                    }
                });
                datasets.push({
                    label: rede, data: data,
                    borderColor: colors[rede],
                    backgroundColor: colors[rede],
                    borderWidth: 3, tension: 0.1
                });
                const metaData = anos.map(ano => {
                    const row = currentData.find(d => d.ano === ano && d.rede === rede);
                    return row && row.meta ? row.meta : null;
                });
                if (metaData.some(m => m !== null)) {
                    datasets.push({
                        label: `Meta - ${rede}`, data: metaData,
                        borderColor: colors[rede],
                        backgroundColor: colors[rede],
                        borderWidth: 2, borderDash: [5, 5],
                        tension: 0.1, pointRadius: 2
                    });
                }
            });
            return datasets;
        }

        function filterRede(rede) {
            currentFilterRede = rede;
            ['all', 'total', 'estadual', 'municipal', 'publica', 'privada'].forEach(r => {
                const btn = document.getElementById(`btn-${r}`);
                btn.className = r === rede
                    ? 'px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm'
                    : 'px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm';
            });
            createChart();
        }

        function filterSerie(serie) {
            currentFilterSerie = serie;
            ['media', '6', '7', '8', '9'].forEach(s => {
                const btn = document.getElementById(`btn-${s}`);
                btn.className = s === serie
                    ? 'px-4 py-2 rounded-lg bg-green-600 text-white text-sm'
                    : 'px-4 py-2 rounded-lg bg-gray-200 text-gray-700 text-sm';
            });
            createChart();
        }

        function updateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            currentData.forEach(row => {
                const media = ((row.s6 + row.s7 + row.s8 + row.s9) / 4).toFixed(1);
                const atingiuMeta = row.meta ? parseFloat(media) >= row.meta : null;
                let statusHtml = '-';
                if (atingiuMeta !== null) {
                    statusHtml = atingiuMeta
                        ? '<span class="text-green-600 font-semibold">‚úì Atingiu</span>'
                        : '<span class="text-red-600 font-semibold">‚úó N√£o atingiu</span>';
                }
                const tr = document.createElement('tr');
                tr.className = 'border-b hover:bg-gray-50';
                tr.innerHTML = `
                    <td class="px-3 py-2 font-semibold">${row.ano}</td>
                    <td class="px-3 py-2">${row.rede}</td>
                    <td class="px-3 py-2 text-center">${row.s6.toFixed(1)}%</td>
                    <td class="px-3 py-2 text-center">${row.s7.toFixed(1)}%</td>
                    <td class="px-3 py-2 text-center">${row.s8.toFixed(1)}%</td>
                    <td class="px-3 py-2 text-center">${row.s9.toFixed(1)}%</td>
                    <td class="px-3 py-2 text-center font-semibold">${media}%</td>
                    <td class="px-3 py-2 text-center text-gray-500">${row.meta ? row.meta.toFixed(1) + '%' : '-'}</td>
                    <td class="px-3 py-2 text-center font-semibold text-blue-600">${row.indicador.toFixed(2)}</td>
                    <td class="px-3 py-2 text-center">${statusHtml}</td>
                `;
                tbody.appendChild(tr);
            });
        }
    </script>
</body>

</html>